<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Anti-Nuker System</title>
</head>
<body>
<pre>local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ServerStorage = game:GetService("ServerStorage")
local ServerScriptService = game:GetService("ServerScriptService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local DataStoreService = game:GetService("DataStoreService")
local HttpService = game:GetService("HttpService")

if not _G.AntiNukerSystem then
    _G.AntiNukerSystem = {
        Running = false,
        Version = "1.0.0",
        LastUpdate = os.time(),
        Connection = nil,
        Connections = {},
        ProtectedServices = {},
        ObjectCreationLog = {},
        ObjectDeletionLog = {},
        BlacklistedStrings = {"nuke", "destroy", "delete", "bomb", "crash", "lag", "exploit", "hack", "server", "script", "flood", "spawn", "mass", "all", "kill"},
        SuspiciousPatterns = {
            "Server[%s_%-]*[Nn]uker?",
            "[Nn]uker?[%s_%-]*[Ss]cript",
            "[Ss]erver[%s_%-]*[Cc]rash",
            "[Ll]ag[%s_%-]*[Ss]erver",
            "[Mm]ass[%s_%-]*[Ss]pawn",
            "[Dd]estroy[%s_%-]*[Aa]ll",
            "[Ee]xploit[%s_%-]*[Ss]cript"
        },
        ProtectionSettings = {
            MaxObjectCreationRate = 50,
            CreationTimeWindow = 3,
            MaxDeletionRate = 40, 
            DeletionTimeWindow = 3,
            MaxPropertyChanges = 30,
            PropertyTimeWindow = 2,
            CheckInterval = 0.5,
            KickMessage = "Suspicious activity detected. You have been removed from the game.",
            LogDetections = true,
            AutoCleanup = true,
            MonitorPropertyChanges = true,
            PreventMassSpawning = true,
            PreventMassDeletion = true,
            PreventUnauthorizedScripts = true,
            AllowedScriptCreators = {},
            MaxChildrenPerInstance = 1000,
            InstanceBlacklist = {
                ["Fire"] = true,
                ["Explosion"] = true,
                ["Sparkles"] = true,
                ["Smoke"] = true,
                ["BloomEffect"] = true,
                ["BlurEffect"] = true,
                ["ColorCorrectionEffect"] = true,
                ["Script"] = true,
                ["LocalScript"] = true,
                ["ModuleScript"] = true
            }
        },
        SuspiciousPlayers = {},
        DetectionHistory = {},
        ProtectedInstances = {}
    }
end

local function isBlacklistedString(str)
    str = string.lower(str)
    for _, blacklisted in ipairs(_G.AntiNukerSystem.BlacklistedStrings) do
        if string.find(str, blacklisted, 1, true) then
            return true
        end
    end
    
    for _, pattern in ipairs(_G.AntiNukerSystem.SuspiciousPatterns) do
        if string.match(str, pattern) then
            return true
        end
    end
    
    return false
end

local function isBlacklistedInstance(instance)
    return _G.AntiNukerSystem.ProtectionSettings.InstanceBlacklist[instance.ClassName] ~= nil
end

local function trackObjectCreation(instance, player)
    local playerName = player and player.Name or "Server"
    local userId = player and player.UserId or 0
    
    if not _G.AntiNukerSystem.ObjectCreationLog[playerName] then
        _G.AntiNukerSystem.ObjectCreationLog[playerName] = {
            Count = 0,
            LastReset = os.time(),
            Objects = {},
            UserId = userId
        }
    end
    
    local log = _G.AntiNukerSystem.ObjectCreationLog[playerName]
    log.Count = log.Count + 1
    table.insert(log.Objects, {
        ClassName = instance.ClassName,
        Name = instance.Name,
        Path = instance:GetFullName(),
        Time = os.time()
    })
    
    if os.time() - log.LastReset >= _G.AntiNukerSystem.ProtectionSettings.CreationTimeWindow then
        log.Count = 1
        log.LastReset = os.time()
        log.Objects = {log.Objects[#log.Objects]}
    end
    
    return log.Count
end

local function trackObjectDeletion(instance, player)
    local playerName = player and player.Name or "Server"
    local userId = player and player.UserId or 0
    
    if not _G.AntiNukerSystem.ObjectDeletionLog[playerName] then
        _G.AntiNukerSystem.ObjectDeletionLog[playerName] = {
            Count = 0,
            LastReset = os.time(),
            Objects = {},
            UserId = userId
        }
    end
    
    local log = _G.AntiNukerSystem.ObjectDeletionLog[playerName]
    log.Count = log.Count + 1
    table.insert(log.Objects, {
        ClassName = instance.ClassName,
        Name = instance.Name,
        Path = instance:GetFullName(),
        Time = os.time()
    })
    
    if os.time() - log.LastReset >= _G.AntiNukerSystem.ProtectionSettings.DeletionTimeWindow then
        log.Count = 1
        log.LastReset = os.time()
        log.Objects = {log.Objects[#log.Objects]}
    end
    
    return log.Count
end

local function recordDetection(player, reason, evidence)
    local playerName = player and player.Name or "Unknown"
    local userId = player and player.UserId or 0
    
    local detection = {
        PlayerName = playerName,
        UserId = userId,
        Reason = reason,
        Evidence = evidence,
        Time = os.time(),
        Timestamp = os.date("%Y-%m-%d %H:%M:%S")
    }
    
    table.insert(_G.AntiNukerSystem.DetectionHistory, detection)
    
    if _G.AntiNukerSystem.ProtectionSettings.LogDetections then
        print(string.format("[Anti-Nuker] Detection: Player=%s, UserId=%d, Reason=%s", 
            playerName, userId, reason))
    end
    
    return detection
end

local function incrementSuspicionLevel(player, amount, reason, evidence)
    if not player then return end
    
    local playerName = player.Name
    
    if not _G.AntiNukerSystem.SuspiciousPlayers[playerName] then
        _G.AntiNukerSystem.SuspiciousPlayers[playerName] = {
            Player = player,
            SuspicionLevel = 0,
            FirstDetection = os.time(),
            LastDetection = os.time(),
            Reasons = {},
            Evidence = {}
        }
    end
    
    local data = _G.AntiNukerSystem.SuspiciousPlayers[playerName]
    data.SuspicionLevel = data.SuspicionLevel + amount
    data.LastDetection = os.time()
    
    if not data.Reasons[reason] then
        data.Reasons[reason] = 1
    else
        data.Reasons[reason] = data.Reasons[reason] + 1
    end
    
    if evidence then
        table.insert(data.Evidence, evidence)
    end
    
    return data.SuspicionLevel
end

local function handleSuspiciousPlayer(player, level, reason)
    if not player then return end
    
    if level >= 100 then
        recordDetection(player, "Critical suspicion level reached: " .. reason, 
            _G.AntiNukerSystem.SuspiciousPlayers[player.Name].Evidence)
        
        task.spawn(function()
            if player and player.Parent then
                task.wait(0.1)
                if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    player.Character.HumanoidRootPart.CFrame = CFrame.new(0, 10000, 0)
                end
                
                task.wait(0.5)
                player:Kick(_G.AntiNukerSystem.ProtectionSettings.KickMessage)
                
                task.wait(1)
                if player and player.Parent then
                    player:Destroy()
                end
            end
        end)
        
        return true
    elseif level >= 70 then
        recordDetection(player, "High suspicion level: " .. reason,
            _G.AntiNukerSystem.SuspiciousPlayers[player.Name].Evidence)
        return false
    elseif level >= 40 then
        recordDetection(player, "Moderate suspicion level: " .. reason, 
            _G.AntiNukerSystem.SuspiciousPlayers[player.Name].Evidence)
        return false
    end
    
    return false
end

local function getPlayerFromInstance(instance)
    if not instance then return nil end
    
    local current = instance
    while current do
        if current:IsA("Player") then
            return current
        end
        
        current = current.Parent
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and (instance:IsDescendantOf(player.Character) or instance == player.Character) then
            return player
        end
    end
    
    return nil
end

local function cleanupSuspiciousObjects(instance, player)
    if _G.AntiNukerSystem.ProtectionSettings.AutoCleanup and isBlacklistedInstance(instance) then
        task.spawn(function()
            task.wait(0.1)
            if instance and instance.Parent then
                instance:Destroy()
                incrementSuspicionLevel(player, 10, "Created blacklisted instance: " .. instance.ClassName, {
                    Type = "InstanceCreation",
                    Class = instance.ClassName,
                    Name = instance.Name,
                    Time = os.time()
                })
            end
        end)
        
        return true
    end
    
    if isBlacklistedString(instance.Name) then
        task.spawn(function()
            task.wait(0.1)
            if instance and instance.Parent then
                instance:Destroy()
                incrementSuspicionLevel(player, 20, "Created instance with blacklisted name: " .. instance.Name, {
                    Type = "InstanceCreation",
                    Class = instance.ClassName,
                    Name = instance.Name,
                    Time = os.time()
                })
            end
        end)
        
        return true
    end
    
    return false
end

local function monitorInstance(instance)
    if not instance or not instance.Parent then return end
    
    local origParent = instance.Parent
    local origName = instance.Name
    
    local connection = instance.AncestryChanged:Connect(function(child, parent)
        if child == instance and parent == nil then
            local player = getPlayerFromInstance(origParent)
            local deletionCount = trackObjectDeletion(instance, player)
            
            if deletionCount > _G.AntiNukerSystem.ProtectionSettings.MaxDeletionRate then
                local level = incrementSuspicionLevel(player, 25, "Mass deletion", {
                    Type = "MassDeletion",
                    Count = deletionCount,
                    LastObject = instance:GetFullName(),
                    Time = os.time()
                })
                
                handleSuspiciousPlayer(player, level, "Mass deletion")
            end
        elseif child == instance and parent ~= nil and parent ~= origParent then
            local player = getPlayerFromInstance(parent)
            origParent = parent
            
            if isBlacklistedString(parent.Name) or (parent:IsA("Script") or parent:IsA("LocalScript") or parent:IsA("ModuleScript")) then
                local level = incrementSuspicionLevel(player, 15, "Moved instance to suspicious parent", {
                    Type = "ParentChange",
                    InstanceName = instance.Name,
                    NewParent = parent:GetFullName(),
                    Time = os.time()
                })
                
                handleSuspiciousPlayer(player, level, "Suspicious parent")
            end
        end
    end)
    
    local nameConnection = instance:GetPropertyChangedSignal("Name"):Connect(function()
        if instance.Name ~= origName then
            local player = getPlayerFromInstance(instance)
            origName = instance.Name
            
            if isBlacklistedString(instance.Name) then
                local level = incrementSuspicionLevel(player, 15, "Renamed to suspicious name", {
                    Type = "NameChange",
                    OldName = origName,
                    NewName = instance.Name,
                    Time = os.time()
                })
                
                cleanupSuspiciousObjects(instance, player)
                handleSuspiciousPlayer(player, level, "Suspicious name")
            end
        end
    end)
    
    if instance:IsA("Script") or instance:IsA("LocalScript") or instance:IsA("ModuleScript") then
        local player = getPlayerFromInstance(instance)
        if player and not table.find(_G.AntiNukerSystem.ProtectionSettings.AllowedScriptCreators, player.UserId) then
            local level = incrementSuspicionLevel(player, 30, "Unauthorized script creation", {
                Type = "ScriptCreation",
                ScriptName = instance.Name,
                ScriptPath = instance:GetFullName(),
                Time = os.time()
            })
            
            cleanupSuspiciousObjects(instance, player)
            handleSuspiciousPlayer(player, level, "Script creation")
        end
    end
    
    if _G.AntiNukerSystem.ProtectionSettings.MonitorPropertyChanges then
        local propChanges = {}
        
        for _, prop in ipairs({"Archivable", "Enabled", "Disabled", "Locked", "Value"}) do
            if pcall(function() return instance[prop] end) then
                local propConnection = instance:GetPropertyChangedSignal(prop):Connect(function()
                    local player = getPlayerFromInstance(instance)
                    
                    if not propChanges[player.Name] then
                        propChanges[player.Name] = {
                            Count = 0,
                            LastReset = os.time()
                        }
                    end
                    
                    local log = propChanges[player.Name]
                    log.Count = log.Count + 1
                    
                    if os.time() - log.LastReset >= _G.AntiNukerSystem.ProtectionSettings.PropertyTimeWindow then
                        log.Count = 1
                        log.LastReset = os.time()
                    elseif log.Count > _G.AntiNukerSystem.ProtectionSettings.MaxPropertyChanges then
                        local level = incrementSuspicionLevel(player, 15, "Mass property changes", {
                            Type = "PropertyChanges",
                            Count = log.Count,
                            Instance = instance:GetFullName(),
                            Time = os.time()
                        })
                        
                        handleSuspiciousPlayer(player, level, "Mass property changes")
                    end
                end)
                
                table.insert(_G.AntiNukerSystem.Connections, propConnection)
            end
        end
    end
    
    table.insert(_G.AntiNukerSystem.Connections, connection)
    table.insert(_G.AntiNukerSystem.Connections, nameConnection)
end

local function clearConnections()
    for _, conn in ipairs(_G.AntiNukerSystem.Connections) do
        if typeof(conn) == "RBXScriptConnection" and conn.Connected then
            conn:Disconnect()
        end
    end
    
    _G.AntiNukerSystem.Connections = {}
end

local function monitorService(service)
    if _G.AntiNukerSystem.ProtectedServices[service.Name] then return end
    
    for _, child in ipairs(service:GetChildren()) do
        monitorInstance(child)
    end
    
    local connection = service.ChildAdded:Connect(function(child)
        local player = getPlayerFromInstance(child)
        local creationCount = trackObjectCreation(child, player)
        
        if _G.AntiNukerSystem.ProtectionSettings.PreventMassSpawning and 
           creationCount > _G.AntiNukerSystem.ProtectionSettings.MaxObjectCreationRate then
            local level = incrementSuspicionLevel(player, 25, "Mass object creation", {
                Type = "MassCreation",
                Count = creationCount,
                LastObject = child:GetFullName(),
                Time = os.time()
            })
            
            handleSuspiciousPlayer(player, level, "Mass object creation")
        end
        
        if child.ClassName == "Folder" or child.ClassName == "Model" or child.ClassName == "Part" then
            if #child:GetChildren() > _G.AntiNukerSystem.ProtectionSettings.MaxChildrenPerInstance then
                local level = incrementSuspicionLevel(player, 25, "Excessive children count", {
                    Type = "ExcessiveChildren",
                    Count = #child:GetChildren(),
                    Instance = child:GetFullName(),
                    Time = os.time()
                })
                
                handleSuspiciousPlayer(player, level, "Excessive children")
                
                task.spawn(function()
                    if child and child.Parent then
                        child:Destroy()
                    end
                end)
                
                return
            end
        end
        
        if not cleanupSuspiciousObjects(child, player) then
            monitorInstance(child)
        end
    end)
    
    table.insert(_G.AntiNukerSystem.Connections, connection)
    _G.AntiNukerSystem.ProtectedServices[service.Name] = true
end

local function setupAntiNuker()
    clearConnections()
    
    monitorService(game)
    monitorService(Workspace)
    monitorService(ReplicatedStorage)
    monitorService(ServerStorage)
    monitorService(ServerScriptService)
    monitorService(Lighting)
    
    for _, player in ipairs(Players:GetPlayers()) do
        local connection = player.CharacterAdded:Connect(function(character)
            monitorInstance(character)
        end)
        
        table.insert(_G.AntiNukerSystem.Connections, connection)
        
        if player.Character then
            monitorInstance(player.Character)
        end
    end
    
    local playerAddedConnection = Players.PlayerAdded:Connect(function(player)
        local connection = player.CharacterAdded:Connect(function(character)
            monitorInstance(character)
        end)
        
        table.insert(_G.AntiNukerSystem.Connections, connection)
    end)
    
    table.insert(_G.AntiNukerSystem.Connections, playerAddedConnection)
    
    local playerRemovingConnection = Players.PlayerRemoving:Connect(function(player)
        if _G.AntiNukerSystem.SuspiciousPlayers[player.Name] then
            _G.AntiNukerSystem.SuspiciousPlayers[player.Name] = nil
        end
    end)
    
    table.insert(_G.AntiNukerSystem.Connections, playerRemovingConnection)
    
    local heartbeatConnection = RunService.Heartbeat:Connect(function()
        if not _G.AntiNukerSystem.LastHeartbeatCheck or 
           tick() - _G.AntiNukerSystem.LastHeartbeatCheck >= _G.AntiNukerSystem.ProtectionSettings.CheckInterval then
            for _, player in ipairs(Players:GetPlayers()) do
                local childCount = 0
                
                if player.Character then
                    childCount = #player.Character:GetDescendants()
                    
                    if childCount > _G.AntiNukerSystem.ProtectionSettings.MaxChildrenPerInstance then
                        local level = incrementSuspicionLevel(player, 20, "Excessive character descendants", {
                            Type = "ExcessiveDescendants",
                            Count = childCount,
                            Time = os.time()
                        })
                        
                        handleSuspiciousPlayer(player, level, "Excessive character objects")
                    end
                end
            end
            
            _G.AntiNukerSystem.LastHeartbeatCheck = tick()
        end
    end)
    
    table.insert(_G.AntiNukerSystem.Connections, heartbeatConnection)
    
    _G.AntiNukerSystem.Running = true
    
    print(string.format(
        "[Anti-Nuker System] Started version %s (Updated: %s)",
        _G.AntiNukerSystem.Version,
        os.date("%Y-%m-%d %H:%M:%S", _G.AntiNukerSystem.LastUpdate)
    ))
end

setupAntiNuker()

local function checkNameSimilarity(name1, name2)
    name1 = string.lower(name1)
    name2 = string.lower(name2)
    
    if name1 == name2 then return 1 end
    
    local matches = 0
    local total = math.max(#name1, #name2)
    
    for i = 1, math.min(#name1, #name2) do
        if string.sub(name1, i, i) == string.sub(name2, i, i) then
            matches = matches + 1
        end
    end
    
    return matches / total
end

local function analyzeInstanceHierarchy(instance, depth)
    depth = depth or 0
    if depth > 10 then return 0, {} end
    
    local suspicionScore = 0
    local suspiciousInstances = {}
    
    if instance:IsA("Script") or instance:IsA("LocalScript") or instance:IsA("ModuleScript") then
        suspicionScore = suspicionScore + 5
        table.insert(suspiciousInstances, {
            Path = instance:GetFullName(),
            Reason = "Script instance",
            Score = 5
        })
    end
    
    if isBlacklistedString(instance.Name) then
        suspicionScore = suspicionScore + 10
        table.insert(suspiciousInstances, {
            Path = instance:GetFullName(),
            Reason = "Blacklisted name",
            Score = 10
        })
    end
    
    if isBlacklistedInstance(instance) then
        suspicionScore = suspicionScore + 5
        table.insert(suspiciousInstances, {
            Path = instance:GetFullName(),
            Reason = "Blacklisted instance type",
            Score = 5
        })
    end
    
    for _, specialName in ipairs({"ServerScriptService", "Workspace", "Players", "ReplicatedStorage"}) do
        if checkNameSimilarity(instance.Name, specialName) > 0.8 and not instance:IsA("Service") then
            suspicionScore = suspicionScore + 15
            table.insert(suspiciousInstances, {
                Path = instance:GetFullName(),
                Reason = "Impersonating service name",
                Score = 15
            })
        end
    end
    
    for _, child in ipairs(instance:GetChildren()) do
        local childScore, childInstances = analyzeInstanceHierarchy(child, depth + 1)
        suspicionScore = suspicionScore + childScore
        
        for _, instance in ipairs(childInstances) do
            table.insert(suspiciousInstances, instance)
        end
    end
    
    return suspicionScore, suspiciousInstances
end

local function scanGame()
    local totalSuspicionScore = 0
    local suspiciousInstances = {}
    
    for _, service in ipairs({Workspace, ReplicatedStorage, ServerStorage, ServerScriptService, Lighting}) do
        local serviceScore, serviceInstances = analyzeInstanceHierarchy(service)
        
        totalSuspicionScore = totalSuspicionScore + serviceScore
        
        for _, instance in ipairs(serviceInstances) do
            table.insert(suspiciousInstances, instance)
        end
    end
    
    if totalSuspicionScore >= 50 then
        print("[Anti-Nuker System] High suspicion level detected in game hierarchy: " .. totalSuspicionScore)
        
        for _, instance in ipairs(suspiciousInstances) do
            print(string.format("  - %s: %s (Score: %d)", 
                instance.Path, instance.Reason, instance.Score))
        end
    end
    
    return totalSuspicionScore, suspiciousInstances
end

scanGame()

return true</pre>
</body>
</html>
